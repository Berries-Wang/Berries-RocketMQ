# 深度解读 RocketMQ 存储机制
> 先阅读[深度解读 RocketMQ 存储机制](./999.深度解读%20RocketMQ%20存储机制.pdf)

## 摘要
### RocketMQ使用的是mmap 而不是 sendfile(kafka)
> [为什么RocketMQ使用mmap而不是sendfile](../../002.FAQ/000.为什么RocketMQ使用mmap而不是sendfile.md)

### RocketMQ 内部存储
#### MessageQueue: 消息存在的逻辑队列
MessageQueue = 多个连续 ConsumeQueue 索引 + CommitLog 文件
+ 消息数据管理: commitlog
+ 索引数据管理: ConsumeQueue (物理文件)

dispatch 线程会源源不断的将消息从 CommitLog 取出，再拿出消息在 CommitLog 中的物理偏移量 (相对于文件存储的 Index)，消息长度以及Tag Hash 作为单条消息的索引，分发到对应的消费队列。偏移 + 长度构成了对 CommitLog 的引用 (Ref)

