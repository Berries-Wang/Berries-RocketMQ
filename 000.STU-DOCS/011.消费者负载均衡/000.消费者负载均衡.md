# 消费者负载均衡
> 阅读:[消费者负载均衡](./消费者负载均衡%20_%20RocketMQ.pdf) , [阿里云消息系列公开课 vol.4 ——《RocketMQ 全新负载均衡机制解析》](../../005.LESSONS/c3c64ad04ad35959_mp4_355043849595_mp4_264_hd_taobao.mp4)

+ 4.x 3.x 版本的RocketMQ 只支持队列粒度的消费者负载均衡
   - 通过文档，此种如果消息都堆积在某一个Consumer上时，只能修改队列数量
     ```shell
        # 在创建Topic时，指定队列数量
        # sh mqadmin updateTopic -n <nameserver地址> -t <Topic名称> -c <集群名称> -w <队列数量>
        sh mqadmin updateTopic -n localhost:9876 -t TestTopic -c DefaultCluster -w 16
     ```
   - 重要!!!  `队列粒度负载均衡策略中，同一消费者分组内的多个消费者将按照队列粒度消费消息，即每个队列仅被一个消费者消费`
   - `队列粒度负载均衡策略保证同一个队列仅被一个消费者处理`，该策略的实现依赖消费者和服务端的信息协商机制，Apache RocketMQ 并不能保证协商结果完全强一致。因此，在消费者数量、队列数量发生变化时，可能会出现短暂的队列分配结果不一致，从而导致少量消息被重复处理。
   - 注意事项:
     ```txt
          1. 在整个Topic的生命周期中，消息队列的数量并不会自动调整。
          2. 从文档来看，当消费者数量远大于消息队列的数量，此时是没有意义的。更好的处理方案是 缩减消费者数量（应大于消息队列数量），将单个消费者的配置升高（CPU ， 内存 ， 消费线程数量）
          》 阿里官方产研确认
     ```
+ 5.x 版本的RocketMQ 支持消息粒度的消费者负载均衡策略