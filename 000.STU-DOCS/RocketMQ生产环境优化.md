# RocketMQ 生产环境优化
1. 生产者优化
   ```txt
      1. 批量发送
      2. 异步发送
      3. 合理设置发送超时时间
   ```
2. 消费者优化
   ```txt
      1. 增加消费者并发度
      2. 批量消费
      3. 合理设置消费次数
   ```
   - 对于第1点，参考: 阅读:[000.消费者负载均衡](./011.消费者负载均衡/000.消费者负载均衡.md),在消费者数量满足的情况下，升级单个消费者的配置（CPU , 内存 ， 消费线程数量）

3. Broker配置优化
   ```txt
      1. 主从异步复制消息
      2. 异步刷盘
   ```
4. 合理设置Topic队列数量
   ```txt
     Apache RocketMQ 的队列数可在创建主题或变更主题时设置修改，队列数量的设置应遵循少用够用原则，避免随意增加队列数量。
     > 少用够用  原则

     且 
       1. 需要根据消息负载和性能监控结果再进行调整
   ```
   - 参考: [队列粒度负载均衡](./011.消费者负载均衡/消费者负载均衡%20_%20RocketMQ.pdf)#队列粒度负载均衡
     ```txt
        对于RocketMQ 4.x ， 因为是队列粒度的负载均衡，当消息堆积了，是否只能调整单个consumer的配置(机器配置，消费线程数量) 来提升消费能力?
     ```
6. JVM优化
   ```txt
      1. 更大内存
      2. 使用更高级的GC Collector
   ```
7. 消息存储优化
   ```txt
       a. 启动文件预热
        warmMapedFileEnable=true
   ```
8. 监控与告警
   ```txt
      配置 Prometheus + Grafana 监控系统状态
   ```
9. 消息压缩
   ```txt
      根据我了解的信息中的信息，RocketMQ对消息体大小的默认限制是不超过4 MB。具体来说：

      消息大小：默认值为不超过4 MB。这个限制不涉及消息压缩，仅计算消息体body的大小。
      取值范围建议：建议不要超过4 MB。
      如果您的应用场景需要传输更大的文件或数据，可以考虑以下几种方法：
      
      将大文件进行分割成多个小文件，每个文件作为单独的消息发送。
      使用对象存储服务（如OSS）来存储文件，并通过消息传递文件的URL。
   ```